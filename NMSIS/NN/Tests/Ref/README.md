# NMSIS-NN Reference Library

**IMPORTANT**: The NMSIS-NN Reference Library is no longer actively maintained. It is now generated by redefining symbols in the NMSIS-NN Libraries.

## Overview

We have used RISC-V P/V intrinsics to optimize the NMSIS-NN Library. To verify the correctness of the optimized code, we provide a reference library for comparison, which is generated without any extension optimizations.

## How to Generate

### 1. Build the NMSIS-NN Library

The NMSIS-NN library is built using the following basic `march` options:

- rv32imac
- rv32imafc
- rv32imafdc
- rv64imac
- rv64imafc
- rv64imafdc

Libraries built with these basic `march` options are used to generate reference libraries.

To build NMSIS-NN Libraries, run the following command:

```bash
cd /path/to/nmsis/root
make gen_nn_lib
```

### 2. Rename Symbols

For example, to verify the optimized code for the `_zve32f` extension with `rv32imafc`, you should compare the behavior of the functions in `libnmis_nn_rv32imafc.a` and `libnmis_nn_rv32imafc_zve32f.a`. However, since the symbols in these two libraries are identical, they cannot be linked together at the same time.

To resolve the above issue, we need to rename the symbols in `libnmis_nn_rv32imafc_zve32f.a`.

A script is provided at [\<NMSIS ROOT\>/Scripts/Build/nnref_autogen.py](../../../Scripts/Build/nnref_autogen.py) to automatically rename the symbols.

This script requires a Python 3 environment, and has been tested with Python 3.8 on Ubuntu 20.04.

To run the script, use the following `make` command:

```bash
cd /path/to/nmsis/root
make gen_nnref_lib
```

This will execute the script and generate the reference libraries in the `<NMSIS ROOT>/Library/NNREF/GCC` directory, along with a header file named `riscv_nnfunctions_ref.h` in the `<NMSIS ROOT>/NN/Tests/Ref/Source` directory.

## How to Build (Deprecated)

Building the NMSIS-NN Reference Library is deprecated because the code is outdated and no longer synchronized with the NMSIS-NN Library.
