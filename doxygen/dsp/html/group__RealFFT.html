<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NMSIS-DSP: Real FFT Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nmsis_logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NMSIS-DSP
   &#160;<span id="projectnumber">Version 1.2.0</span>
   </div>
   <div id="projectbrief">NMSIS DSP Software Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__RealFFT.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Real FFT Functions<div class="ingroups"><a class="el" href="group__groupTransforms.html">Transform Functions</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__RealFFTF16"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RealFFTF16.html">Real FFT F16 Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__RealFFTF64"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RealFFTF64.html">Real FFT F64 Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__RealFFTQ15"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RealFFTQ15.html">Real FFT Q15 Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__RealFFTQ31"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RealFFTQ31.html">Real FFT Q31 Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__RealFFT__Table"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RealFFT__Table.html">Real FFT Tables</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__RealFFTF32"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RealFFTF32.html">Real FFT F32 Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__DeprecatedRealFFT"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DeprecatedRealFFT.html">Deprecated Real FFT Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac6c836bb35dcbdd2a96d38ae9bfadd7f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RealFFT.html#gac6c836bb35dcbdd2a96d38ae9bfadd7f">riscv_rfft_q15</a> (const <a class="el" href="structriscv__rfft__instance__q15.html">riscv_rfft_instance_q15</a> *S, q15_t *pSrc, q15_t *pDst)</td></tr>
<tr class="memdesc:gac6c836bb35dcbdd2a96d38ae9bfadd7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processing function for the Q15 RFFT/RIFFT.  <a href="group__RealFFT.html#gac6c836bb35dcbdd2a96d38ae9bfadd7f">More...</a><br /></td></tr>
<tr class="separator:gac6c836bb35dcbdd2a96d38ae9bfadd7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<dl class="section user"><dt></dt><dd>The NMSIS DSP library includes specialized algorithms for computing the FFT of real data sequences. The FFT is defined over complex data but in many applications the input is real. Real FFT algorithms take advantage of the symmetry properties of the FFT and have a speed advantage over complex algorithms of the same length. </dd></dl>
<dl class="section user"><dt></dt><dd>The Fast RFFT algorithm relays on the mixed radix CFFT that save processor usage. </dd></dl>
<dl class="section user"><dt></dt><dd>The real length N forward FFT of a sequence is computed using the steps shown below. </dd></dl>
<dl class="section user"><dt></dt><dd><div class="image">
<img src="RFFT.png" alt=""/>
<div class="caption">
Real Fast Fourier Transform</div></div>
 </dd></dl>
<dl class="section user"><dt></dt><dd>The real sequence is initially treated as if it were complex to perform a CFFT. Later, a processing stage reshapes the data to obtain half of the frequency spectrum in complex format.</dd></dl>
<dl class="section user"><dt></dt><dd>The input for the inverse RFFT should keep the same format as the output of the forward RFFT. A first processing stage pre-process the data to later perform an inverse CFFT. </dd></dl>
<dl class="section user"><dt></dt><dd><div class="image">
<img src="RIFFT.png" alt=""/>
<div class="caption">
Real Inverse Fast Fourier Transform</div></div>
 </dd></dl>
<dl class="section user"><dt></dt><dd>The algorithms for floating-point, Q15, and Q31 data are slightly different and we describe each algorithm in turn. </dd></dl>
<dl class="section user"><dt>Floating-point</dt><dd>The main functions are <a class="el" href="group__RealFFTF32.html#ga79d52dd65555bdaae27fdd20c95f04a1">riscv_rfft_fast_f32()</a> and <a class="el" href="group__RealFFTF32.html#gaa09af308fb200adedfaebdd7ca4f57cf">riscv_rfft_fast_init_f32()</a>. The older functions <a class="el" href="group__DeprecatedRealFFT.html#ga15270da93ab349377512694e2704a324">riscv_rfft_f32()</a> and <a class="el" href="group__DeprecatedRealFFT.html#ga84650b5ce6836a7cd0f0fc9da41fb3cf">riscv_rfft_init_f32()</a> have been deprecated but are still documented. For f16, the functions are <a class="el" href="group__RealFFTF16.html#ga1d961d1feb6ee5fda766d33bd4b46e66">riscv_rfft_fast_f16()</a> and <a class="el" href="group__RealFFTF16.html#ga4fa1ff980776c277635055574b38ae27">riscv_rfft_fast_init_f16()</a>. For f64, the functions are <a class="el" href="group__RealFFTF64.html#ga4f4fcfb79e7b2ae83929a5e77a9fadd1">riscv_rfft_fast_f64()</a> and <a class="el" href="group__RealFFTF64.html#gabb579b9db993b4960326a58032202bb3">riscv_rfft_fast_init_f64()</a>. </dd></dl>
<dl class="section user"><dt></dt><dd>The FFT of a real N-point sequence has even symmetry in the frequency domain. The second half of the data equals the conjugate of the first half flipped in frequency. This conjugate part is not computed by the float RFFT. As consequence, the output of a N point real FFT should be a N//2 + 1 complex numbers so N + 2 floats. </dd></dl>
<dl class="section user"><dt></dt><dd>It happens that the first complex of number of the RFFT output is actually all real. Its real part represents the DC offset. The value at Nyquist frequency is also real.</dd></dl>
<dl class="section user"><dt></dt><dd>Those two complex numbers can be encoded with 2 floats rather than using two numbers with an imaginary part set to zero. </dd></dl>
<dl class="section user"><dt></dt><dd>The implementation is using a trick so that the output buffer can be N float : the last real is packaged in the imaginary part of the first complex (since this imaginary part is not used and is zero).</dd></dl>
<dl class="section user"><dt></dt><dd>The real FFT functions pack the frequency domain data in this fashion. The forward transform outputs the data in this form and the inverse transform expects input data in this form. The function always performs the needed bitreversal so that the input and output data is always in normal order. The functions support lengths of [32, 64, 128, ..., 4096] samples. </dd></dl>
<dl class="section user"><dt>Q15 and Q31</dt><dd>The real algorithms are defined in a similar manner and utilize N/2 complex transforms behind the scenes.</dd></dl>
<dl class="section user"><dt></dt><dd>But warning, contrary to the float version, the fixed point implementation RFFT is also computing the conjugate part (except for MVE version) so the output buffer must be bigger. Also the fixed point RFFTs are not using any trick to pack the DC and Nyquist frequency in the same complex number. The RIFFT is not using the conjugate part but it is still using the Nyquist frequency value. The details are given in the documentation for the functions. </dd></dl>
<dl class="section user"><dt></dt><dd>The complex transforms used internally include scaling to prevent fixed-point overflows. The overall scaling equals 1/(fftLen/2). Due to the use of complex transform internally, the source buffer is modified by the rfft. </dd></dl>
<dl class="section user"><dt></dt><dd>A separate instance structure must be defined for each transform used but twiddle factor and bit reversal tables can be reused. </dd></dl>
<dl class="section user"><dt></dt><dd>There is also an associated initialization function for each data type. The initialization function performs the following operations:<ul>
<li>Sets the values of the internal structure fields.</li>
<li>Initializes twiddle factor table and bit reversal table pointers.</li>
<li>Initializes the internal complex FFT data structure. </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>Use of the initialization function is optional <b>except for MVE versions where it is mandatory</b>. If you don't use the initialization functions, then the structures should be initialized with code similar to the one below: <pre>
      <a class="el" href="structriscv__rfft__instance__q31.html" title="Instance structure for the Q31 RFFT/RIFFT function.">riscv_rfft_instance_q31</a> S = {fftLenReal, fftLenBy2, ifftFlagR, bitReverseFlagR, twidCoefRModifier, pTwiddleAReal, pTwiddleBReal, pCfft};
      <a class="el" href="structriscv__rfft__instance__q15.html" title="Instance structure for the Q15 RFFT/RIFFT function.">riscv_rfft_instance_q15</a> S = {fftLenReal, fftLenBy2, ifftFlagR, bitReverseFlagR, twidCoefRModifier, pTwiddleAReal, pTwiddleBReal, pCfft};
  </pre> where <code>fftLenReal</code> is the length of the real transform; <code>fftLenBy2</code> length of the internal complex transform (fftLenReal/2). <code>ifftFlagR</code> Selects forward (=0) or inverse (=1) transform. <code>bitReverseFlagR</code> Selects bit reversed output (=0) or normal order output (=1). <code>twidCoefRModifier</code> stride modifier for the twiddle factor table. The value is based on the FFT length; <code>pTwiddleAReal</code>points to the A array of twiddle coefficients; <code>pTwiddleBReal</code>points to the B array of twiddle coefficients; <code>pCfft</code> points to the CFFT Instance structure. The CFFT structure must also be initialized. <br  />
 </dd></dl>
<dl class="section user"><dt></dt><dd>Note that with MVE versions you can't initialize instance structures directly and <b>must use the initialization function</b>. </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a id="gac6c836bb35dcbdd2a96d38ae9bfadd7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac6c836bb35dcbdd2a96d38ae9bfadd7f">&#9670;&nbsp;</a></span>riscv_rfft_q15()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void riscv_rfft_q15 </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structriscv__rfft__instance__q15.html">riscv_rfft_instance_q15</a> *&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">q15_t *&#160;</td>
          <td class="paramname"><em>pSrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">q15_t *&#160;</td>
          <td class="paramname"><em>pDst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processing function for the Q15 RFFT/RIFFT. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">S</td><td>points to an instance of the Q15 RFFT/RIFFT structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pSrc</td><td>points to input buffer (Source buffer is modified by this function.) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pDst</td><td>points to output buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none</dd></dl>
<dl class="section user"><dt>Input an output formats</dt><dd>Internally input is downscaled by 2 for every stage to avoid saturations inside CFFT/CIFFT process. Hence the output format is different for different RFFT sizes. The input and output formats for different RFFT sizes and number of bits to upscale are mentioned in the tables below for RFFT and RIFFT: </dd></dl>
<dl class="section user"><dt>Input and Output formats for RFFT Q15</dt><dd></dd></dl>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight">RFFT Size </th><th class="markdownTableHeadRight">Input Format </th><th class="markdownTableHeadRight">Output Format </th><th class="markdownTableHeadRight">Number of bits to upscale  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">32 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">6.10 </td><td class="markdownTableBodyRight">5  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">64 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">7.9 </td><td class="markdownTableBodyRight">6  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">128 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">8.8 </td><td class="markdownTableBodyRight">7  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">256 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">9.7 </td><td class="markdownTableBodyRight">8  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">512 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">10.6 </td><td class="markdownTableBodyRight">9  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">1024 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">11.5 </td><td class="markdownTableBodyRight">10  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">2048 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">12.4 </td><td class="markdownTableBodyRight">11  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">4096 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">13.3 </td><td class="markdownTableBodyRight">12  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">8192 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">14.2 </td><td class="markdownTableBodyRight">13  </td></tr>
</table>
<dl class="section user"><dt>Input and Output formats for RIFFT Q15</dt><dd></dd></dl>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight">RIFFT Size </th><th class="markdownTableHeadRight">Input Format </th><th class="markdownTableHeadRight">Output Format </th><th class="markdownTableHeadRight">Number of bits to upscale  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">32 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">6.10 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">64 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">7.9 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">128 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">8.8 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">256 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">9.7 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">512 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">10.6 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">1024 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">11.5 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">2048 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">12.4 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">4096 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">13.3 </td><td class="markdownTableBodyRight">0  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">8192 </td><td class="markdownTableBodyRight">1.15 </td><td class="markdownTableBodyRight">14.2 </td><td class="markdownTableBodyRight">0  </td></tr>
</table>
<dl class="section user"><dt></dt><dd>If the input buffer is of length N (fftLenReal), the output buffer must have length 2N since it is containing the conjugate part. The input buffer is modified by this function. </dd></dl>
<dl class="section user"><dt></dt><dd>For the RIFFT, the source buffer must have length N+2 since the Nyquist frequency value is needed but conjugate part is ignored. It is not using the packing trick of the float version. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Nov 3 2023 09:15:57 for NMSIS-DSP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
