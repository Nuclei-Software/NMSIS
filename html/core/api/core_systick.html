

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Systick Timer(SysTimer) &mdash; NMSIS 1.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Interrupts and Exceptions" href="core_interrupt_exception.html" />
    <link rel="prev" title="Peripheral Access" href="core_periph_access.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/nmsis_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introduction.html">Nuclei MCU Software Interface Standard(NMSIS)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">NMSIS Core</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get_started.html">Using NMSIS in Embedded Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core_templates.html">NMSIS-Core Device Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../register_mapping.html">Register Mapping</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">NMSIS Core API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="core_version_control.html">Version Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_compiler_control.html">Compiler Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_csr_access.html">Core CSR Register Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_csr_encoding.html">Core CSR Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_register_type.html">Register Define and Type Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_intrinsics.html">CPU Intrinsic Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api_nmsis_core_dsp_intrinsic.html">Intrinsic Functions for SIMD Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_periph_access.html">Peripheral Access</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Systick Timer(SysTimer)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#systimer-api">SysTimer API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#systick-code-example">SysTick Code Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#systimer-interrupt-code-example">SysTimer Interrupt Code Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="core_interrupt_exception.html">Interrupts and Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_fpu.html">FPU Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_pmp.html">PMP Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_cache.html">Cache Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_system_device.html">System Device Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="core_arm_compatiable.html">ARM Compatiable Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dsp/index.html">NMSIS DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nn/index.html">NMSIS NN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NMSIS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">NMSIS Core</a> &raquo;</li>
        
          <li><a href="index.html">NMSIS Core API</a> &raquo;</li>
        
      <li>Systick Timer(SysTimer)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/core/api/core_systick.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="systick-timer-systimer">
<span id="core-api-systick"></span><h1>Systick Timer(SysTimer)<a class="headerlink" href="#systick-timer-systimer" title="Permalink to this headline">¶</a></h1>
<p>Click <a class="reference external" href="https://doc.nucleisys.com/nuclei_spec/isa/timer.html">Nuclei Timer Unit</a> to learn about Core Timer Unit in Nuclei ISA Spec.</p>
<div class="section" id="systimer-api">
<h2>SysTimer API<a class="headerlink" href="#systimer-api" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga08c74ffae27d46218ae11321ff5e1673"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetLoadValue(uint64_t value)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga5b454e48769abd7a88c2cc65fe53ac7a"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint64_t SysTimer_GetLoadValue(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga52e85918789aa95fc4cd0d7238ca9b6c"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetCompareValue(uint64_t value)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga515d63f4e4581430fb0bf6e864e5bca9"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint64_t SysTimer_GetCompareValue(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga95360ac7f66badad67c57d540a1ae4e1"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_Start(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gaf74222f6d8c603f61571884732726e91"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_Stop(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gaf0e25c3ad2965ce6cd523cd101cee16f"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetControlValue(uint32_t mctl)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gafc922423699826bc5d833ab5d08219d2"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint32_t SysTimer_GetControlValue(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gaa4d13cddf35ef77fd3b3b59e82eb1d47"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetSWIRQ(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga57b4f64ed87262daf831573e704b12c8"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_ClearSWIRQ(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga0431e3f4a44ca2265884c19096912729"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint32_t SysTimer_GetMsipValue(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gaa7f8e6c1423f582f958e151ce692395c"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetMsipValue(uint32_t msip)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gac41101f6eb4776148a05d1b02b643f8e"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SoftwareReset(void)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga349805c25d9aa753c6fd69b3c0151126"></span><code class="sig-name descname">__STATIC_INLINE uint32_t SysTick_Config(uint64_t ticks)</code></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga9906dae1937eac222354df5a9069945a"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint32_t SysTick_Reload(uint64_t ticks)</code></dt>
<dd></dd></dl>

<dl class="group">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer"></span><em>group</em> <code class="sig-name descname">NMSIS_Core_SysTimer</code></dt>
<dd><p>Functions that configure the Core System Timer. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Functions</p>
<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga08c74ffae27d46218ae11321ff5e1673"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetLoadValue(uint64_t value)</code></dt>
<dd><p>Set system timer load value. </p>
<p>This function set the system timer load value in MTIMER register. <dl class="simple">
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>Load value is 64bits wide.</p></li>
<li><p>SysTimer_GetLoadValue </p></li>
</ul>
</p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[in]</span> <span class="pre">value</span></code>: value to set system timer MTIMER register. </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga5b454e48769abd7a88c2cc65fe53ac7a"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint64_t SysTimer_GetLoadValue(void)</code></dt>
<dd><p>Get system timer load value. </p>
<p>This function get the system timer current value in MTIMER register. <dl class="simple">
<dt><strong>Return</strong></dt><dd><p>current value(64bit) of system timer MTIMER register. </p>
</dd>
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>Load value is 64bits wide.</p></li>
<li><p>SysTimer_SetLoadValue </p></li>
</ul>
</p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga52e85918789aa95fc4cd0d7238ca9b6c"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetCompareValue(uint64_t value)</code></dt>
<dd><p>Set system timer compare value. </p>
<p>This function set the system Timer compare value in MTIMERCMP register. <dl class="simple">
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>Compare value is 64bits wide.</p></li>
<li><p>If compare value is larger than current value timer interrupt generate.</p></li>
<li><p>Modify the load value or compare value less to clear the interrupt.</p></li>
<li><p>SysTimer_GetCompareValue </p></li>
</ul>
</p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[in]</span> <span class="pre">value</span></code>: compare value to set system timer MTIMERCMP register. </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga515d63f4e4581430fb0bf6e864e5bca9"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint64_t SysTimer_GetCompareValue(void)</code></dt>
<dd><p>Get system timer compare value. </p>
<p>This function get the system timer compare value in MTIMERCMP register. <dl class="simple">
<dt><strong>Return</strong></dt><dd><p>compare value of system timer MTIMERCMP register. </p>
</dd>
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>Compare value is 64bits wide.</p></li>
<li><p>SysTimer_SetCompareValue </p></li>
</ul>
</p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga95360ac7f66badad67c57d540a1ae4e1"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_Start(void)</code></dt>
<dd><p>Enable system timer counter running. </p>
<p>Enable system timer counter running by clear TIMESTOP bit in MTIMECTL register. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gaf74222f6d8c603f61571884732726e91"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_Stop(void)</code></dt>
<dd><p>Stop system timer counter running. </p>
<p>Stop system timer counter running by set TIMESTOP bit in MTIMECTL register. </p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gaf0e25c3ad2965ce6cd523cd101cee16f"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetControlValue(uint32_t mctl)</code></dt>
<dd><p>Set system timer control value. </p>
<p>This function set the system timer MTIMECTL register value. <dl class="simple">
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>Bit TIMESTOP is used to start and stop timer. Clear TIMESTOP bit to 0 to start timer, otherwise to stop timer.</p></li>
<li><p>Bit CMPCLREN is used to enable auto MTIMER clear to zero when MTIMER &gt;= MTIMERCMP. Clear CMPCLREN bit to 0 to stop auto clear MTIMER feature, otherwise to enable it.</p></li>
<li><p>Bit CLKSRC is used to select timer clock source. Clear CLKSRC bit to 0 to use <em>mtime_toggle_a</em>, otherwise use <em>core_clk_aon</em></p></li>
<li><p>SysTimer_GetControlValue </p></li>
</ul>
</p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[in]</span> <span class="pre">mctl</span></code>: value to set MTIMECTL register </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gafc922423699826bc5d833ab5d08219d2"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint32_t SysTimer_GetControlValue(void)</code></dt>
<dd><p>Get system timer control value. </p>
<p>This function get the system timer MTIMECTL register value. <dl class="simple">
<dt><strong>Return</strong></dt><dd><p>MTIMECTL register value </p>
</dd>
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>SysTimer_SetControlValue </p></li>
</ul>
</p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gaa4d13cddf35ef77fd3b3b59e82eb1d47"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetSWIRQ(void)</code></dt>
<dd><p>Trigger or set software interrupt via system timer. </p>
<p>This function set the system timer MSIP bit in MSIP register. <dl class="simple">
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>Set system timer MSIP bit and generate a SW interrupt.</p></li>
<li><p>SysTimer_ClearSWIRQ</p></li>
<li><p>SysTimer_GetMsipValue </p></li>
</ul>
</p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga57b4f64ed87262daf831573e704b12c8"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_ClearSWIRQ(void)</code></dt>
<dd><p>Clear system timer software interrupt pending request. </p>
<p>This function clear the system timer MSIP bit in MSIP register. <dl class="simple">
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>Clear system timer MSIP bit in MSIP register to clear the software interrupt pending.</p></li>
<li><p>SysTimer_SetSWIRQ</p></li>
<li><p>SysTimer_GetMsipValue </p></li>
</ul>
</p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga0431e3f4a44ca2265884c19096912729"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint32_t SysTimer_GetMsipValue(void)</code></dt>
<dd><p>Get system timer MSIP register value. </p>
<p>This function get the system timer MSIP register value. <dl class="simple">
<dt><strong>Return</strong></dt><dd><p>Value of Timer MSIP register. </p>
</dd>
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>Bit0 is SW interrupt flag. Bit0 is 1 then SW interrupt set. Bit0 is 0 then SW interrupt clear.</p></li>
<li><p>SysTimer_SetSWIRQ</p></li>
<li><p>SysTimer_ClearSWIRQ </p></li>
</ul>
</p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gaa7f8e6c1423f582f958e151ce692395c"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SetMsipValue(uint32_t msip)</code></dt>
<dd><p>Set system timer MSIP register value. </p>
<p>This function set the system timer MSIP register value. <dl class="simple">
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[in]</span> <span class="pre">msip</span></code>: value to set MSIP register </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1gac41101f6eb4776148a05d1b02b643f8e"></span><code class="sig-name descname">__STATIC_FORCEINLINE void SysTimer_SoftwareReset(void)</code></dt>
<dd><p>Do software reset request. </p>
<p>This function will do software reset request through MTIMER<ul class="simple">
<li><p>Software need to write <a class="reference internal" href="core_register_type.html#group__NMSIS__Core__SysTimer__Registers_1ga181dffb1870282631f8858ea23d9b8fa"><span class="std std-ref">SysTimer_MSFRST_KEY</span></a> to generate software reset request</p></li>
<li><p>The software request flag can be cleared by reset operation to clear <dl class="simple">
<dt><strong>Remark</strong></dt><dd><p></p>
</dd>
</dl>
</p></li>
<li><p>The software reset is sent to SoC, SoC need to generate reset signal and send back to Core</p></li>
<li><p>This function will not return, it will do while(1) to wait the Core reset happened </p></li>
</ul>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga349805c25d9aa753c6fd69b3c0151126"></span><code class="sig-name descname">__STATIC_INLINE uint32_t SysTick_Config(uint64_t ticks)</code></dt>
<dd><p>System Tick Configuration. </p>
<p>Initializes the System Timer and its non-vector interrupt, and starts the System Tick Timer.</p>
<p>In our default implementation, the timer counter will be set to zero, and it will start a timer compare non-vector interrupt when it matchs the ticks user set, during the timer interrupt user should reload the system tick using SysTick_Reload function or similar function written by user, so it can produce period timer interrupt. <dl>
<dt><strong>Return</strong></dt><dd><p>0 Function succeeded. </p>
<p>1 Function failed. </p>
</dd>
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>For <a class="reference internal" href="core_version_control.html#group__NMSIS__Core__VersionControl_1ga1b769df3cb99a779a9abaeb6e00d46f5"><span class="std std-ref">__NUCLEI_N_REV</span></a> &gt;= 0x0104, the CMPCLREN bit in MTIMECTL is introduced, but we assume that the CMPCLREN bit is set to 0, so MTIMER register will not be auto cleared to 0 when MTIMER &gt;= MTIMERCMP.</p></li>
<li><p>When the variable __Vendor_SysTickConfig is set to 1, then the function SysTick_Config is not included.</p></li>
<li><p>In this case, the file <strong>&lt;Device&gt;.h</strong> must contain a vendor-specific implementation of this function.</p></li>
<li><p>If user need this function to start a period timer interrupt, then in timer interrupt handler routine code, user should call SysTick_Reload with ticks to reload the timer.</p></li>
<li><p>This function only available when __SYSTIMER_PRESENT == 1 and __ECLIC_PRESENT == 1 and __Vendor_SysTickConfig == 0 </p></li>
</ul>
</p>
</dd>
<dt><strong>See</strong></dt><dd><p><ul class="simple">
<li><p>SysTimer_SetCompareValue; SysTimer_SetLoadValue </p></li>
</ul>
</p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[in]</span> <span class="pre">ticks</span></code>: Number of ticks between two interrupts. </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt>
<span class="target" id="group__NMSIS__Core__SysTimer_1ga9906dae1937eac222354df5a9069945a"></span><code class="sig-name descname">__STATIC_FORCEINLINE uint32_t SysTick_Reload(uint64_t ticks)</code></dt>
<dd><p>System Tick Reload. </p>
<p>Reload the System Timer Tick when the MTIMECMP reached TIME value</p>
<p><dl>
<dt><strong>Return</strong></dt><dd><p>0 Function succeeded. </p>
<p>1 Function failed. </p>
</dd>
<dt><strong>Remark</strong></dt><dd><p><ul class="simple">
<li><p>For <a class="reference internal" href="core_version_control.html#group__NMSIS__Core__VersionControl_1ga1b769df3cb99a779a9abaeb6e00d46f5"><span class="std std-ref">__NUCLEI_N_REV</span></a> &gt;= 0x0104, the CMPCLREN bit in MTIMECTL is introduced, but for this SysTick_Config function, we assume this CMPCLREN bit is set to 0, so in interrupt handler function, user still need to set the MTIMERCMP or MTIMER to reload the system tick, if vendor want to use this timer’s auto clear feature, they can define __Vendor_SysTickConfig to 1, and implement SysTick_Config and SysTick_Reload functions.</p></li>
<li><p>When the variable __Vendor_SysTickConfig is set to 1, then the function SysTick_Reload is not included.</p></li>
<li><p>In this case, the file <strong>&lt;Device&gt;.h</strong> must contain a vendor-specific implementation of this function.</p></li>
<li><p>This function only available when __SYSTIMER_PRESENT == 1 and __ECLIC_PRESENT == 1 and __Vendor_SysTickConfig == 0</p></li>
<li><p>Since the MTIMERCMP value might overflow, if overflowed, MTIMER will be set to 0, and MTIMERCMP set to ticks </p></li>
</ul>
</p>
</dd>
<dt><strong>See</strong></dt><dd><p><ul class="simple">
<li><p>SysTimer_SetCompareValue</p></li>
<li><p>SysTimer_SetLoadValue </p></li>
</ul>
</p>
</dd>
<dt><strong>Parameters</strong></dt><dd><ul class="breatheparameterlist simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[in]</span> <span class="pre">ticks</span></code>: Number of ticks between two interrupts. </p></li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
</dd></dl>

</div>
<div class="section" id="systick-code-example">
<span id="core-systick-code-example"></span><h2>SysTick Code Example<a class="headerlink" href="#systick-code-example" title="Permalink to this headline">¶</a></h2>
<p>The code below shows the usage of the function <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">SysTick_Config()</span></code> and <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">SysTick_Reload()</span></code> with an GD32VF103 SoC.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">gd32vf103_systick_example.c</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;gd32vf103.h&quot;</span><span class="cp"></span>

<span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="n">msTicks</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                              <span class="cm">/* Variable to store millisecond ticks */</span>

<span class="cp">#define CONFIG_TICKS        (SOC_TIMER_FREQ / 1000)</span>
<span class="cp">#define SysTick_Handler     eclic_mtip_handler</span>

<span class="kt">void</span> <span class="nf">SysTick_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>                                <span class="cm">/* SysTick interrupt Handler. */</span>
  <span class="n">SysTimer_Reload</span><span class="p">(</span><span class="n">CONFIG_TICKS</span><span class="p">);</span>                            <span class="cm">/* Call SysTick_Reload to reload timer. */</span>
  <span class="n">msTicks</span><span class="o">++</span><span class="p">;</span>                                                <span class="cm">/* See startup file startup_gd32vf103.S for SysTick vector */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">uint32_t</span> <span class="n">returnCode</span><span class="p">;</span>

  <span class="n">returnCode</span> <span class="o">=</span> <span class="n">SysTick_Config</span><span class="p">(</span><span class="n">CONFIG_TICKS</span><span class="p">);</span>                <span class="cm">/* Configure SysTick to generate an interrupt every millisecond */</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">returnCode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                                    <span class="cm">/* Check return code for errors */</span>
    <span class="c1">// Error Handling</span>
  <span class="p">}</span>

  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="systimer-interrupt-code-example">
<span id="core-systimer-interrupt-code-example"></span><h2>SysTimer Interrupt Code Example<a class="headerlink" href="#systimer-interrupt-code-example" title="Permalink to this headline">¶</a></h2>
<p>The code below shows the usage of various NMSIS Timer Interrupt functions with an GD32VF103 device.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">gd32vf103_timer_example1.c</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;gd32vf103.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">eclic_mtip_handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint64_t</span> <span class="n">now</span> <span class="o">=</span>  <span class="n">SysTimer_GetLoadValue</span><span class="p">();</span>
    <span class="n">SysTimer_SetCompareValue</span><span class="p">(</span><span class="n">now</span> <span class="o">+</span> <span class="n">SOC_TIMER_FREQ</span><span class="o">/</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">int_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">eclic_msip_handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SysTimer_ClearSWIRQ</span><span class="p">();</span>
    <span class="n">int_cnt</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">eclic_global_initialize</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ECLIC_SetMth</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">ECLIC_SetCfgNlbits</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">eclic_register_interrupt</span><span class="p">(</span><span class="n">IRQn_Type</span> <span class="n">IRQn</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">shv</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">trig_mode</span><span class="p">,</span> <span class="n">uint32</span> <span class="n">lvl</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">priority</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span> <span class="n">handler</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ECLIC_SetShvIRQ</span><span class="p">(</span><span class="n">IRQn</span><span class="p">,</span> <span class="n">shv</span><span class="p">);</span>
    <span class="n">ECLIC_SetTrigIRQ</span><span class="p">(</span><span class="n">IRQn</span><span class="p">,</span> <span class="n">trig_mode</span><span class="p">);</span>
    <span class="n">ECLIC_SetLevelIRQ</span><span class="p">(</span><span class="n">IRQn</span><span class="p">,</span> <span class="n">lvl</span><span class="p">);</span>
    <span class="n">ECLIC_SetPriorityIRQ</span><span class="p">(</span><span class="n">IRQn</span><span class="p">,</span> <span class="n">priority</span><span class="p">);</span>
    <span class="n">ECLIC_SetVector</span><span class="p">(</span><span class="n">IRQn</span><span class="p">,</span> <span class="p">(</span><span class="n">rv_csr_t</span><span class="p">)(</span><span class="n">handler</span><span class="p">));</span>
    <span class="n">ECLIC_EnableIRQ</span><span class="p">(</span><span class="n">IRQn</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup_timer</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SysTimer_SetLoadValue</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">SysTimer_SetCompareValue</span><span class="p">(</span><span class="n">SOC_TIMER_FREQ</span><span class="o">/</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">returnCode</span><span class="p">;</span>

    <span class="n">eclic_global_initialize</span><span class="p">();</span>                                <span class="cm">/* initialize ECLIC */</span>

    <span class="n">setup_timer</span><span class="p">();</span>                                            <span class="cm">/* initialize timer */</span>

    <span class="n">returnCode</span> <span class="o">=</span> <span class="n">eclic_register_interrupt</span><span class="p">(</span><span class="n">SysTimer_IRQn</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">eclic_mtip_handler</span><span class="p">);</span>  <span class="cm">/* register system timer interrupt */</span>

    <span class="n">returnCode</span> <span class="o">=</span> <span class="n">eclic_register_interrupt</span><span class="p">(</span><span class="n">SysTimerSW_IRQn</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">eclic_msip_handler</span><span class="p">);</span>  <span class="cm">/* register system timer SW interrupt */</span>

    <span class="n">__enable_irq</span><span class="p">();</span>                                           <span class="cm">/* enable global interrupt */</span>

    <span class="n">SysTimer_SetSWIRQ</span><span class="p">();</span>                                      <span class="cm">/* trigger timer SW interrupt */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">returnCode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                                    <span class="cm">/* Check return code for errors */</span>
      <span class="c1">// Error Handling</span>
    <span class="p">}</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="core_interrupt_exception.html" class="btn btn-neutral float-right" title="Interrupts and Exceptions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="core_periph_access.html" class="btn btn-neutral float-left" title="Peripheral Access" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-Present, Nuclei
      <span class="lastupdated">
        Last updated on Dec 10, 2020.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>